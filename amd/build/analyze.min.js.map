{"version":3,"file":"analyze.min.js","sources":["../src/analyze.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint-disable no-console */\n\n/**\n * Analyze the page content to calculate the SEO score and\n * display the data and problems to the admin.\n *\n * @module     theme_seo/analyze\n * @copyright  2025 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport SeoCheck from \"theme_seo/seord\";\nimport $ from \"jquery\";\nimport Templates from \"core/templates\";\n\nexport const init = function(publicPage = true, redirected = false) {\n    $(async function() {\n        let toogelTimeout;\n        $('.seo-manager-footer__toggle').on('click', function() {\n            clearTimeout(toogelTimeout);\n            $('.seo-manager-footer__content').slideToggle();\n\n            toogelTimeout = setTimeout(() => {\n                let isVisible = $('.seo-manager-footer__content').is(':visible');\n                $(this).html(isVisible ? '&times;' : '&#9650;');\n            }, 500);\n        });\n        if (!publicPage || redirected) {\n            return;\n        }\n\n        let keywords = document.querySelector(\"meta[name='keywords']\")?.content || \"\";\n        keywords = keywords.split(\",\").map((value) => value.trim());\n\n        const contentJson = {\n            title: document.title || \"Untitled Page\",\n            // Get the content appeared to the crawler.\n            htmlText: $('[data-purpose=\"seo-page-content\"]').html(),\n            keyword: keywords.shift() ?? '',\n            subKeywords: keywords,\n            metaDescription: document.querySelector(\"meta[name='description']\")?.content || \"\",\n            languageCode: M.cfg.language,\n            // countryCode: \"us\"\n        };\n\n        // Initialize SeoCheck with structured content\n        let checker = new SeoCheck(contentJson, window.location.hostname, true);\n\n        // Perform analysis\n        let result = await checker.analyzeSeo();\n\n        // Log the SEO report for debugging only.\n        // console.log(\"SEO Analysis Report:\", result);\n        // Display the SEO report\n        let context = {\n            seoscore: result.seoScore,\n            wordcount: result.wordCount,\n            keywordseoscore: result.keywordSeoScore,\n            keyworddensity: result.keywordDensity,\n            keywordfrequency: result.keywordFrequency,\n            pagetitle: contentJson.title,\n            metadescription: contentJson.metaDescription,\n            keyword: contentJson.keyword,\n            subkeywords: contentJson.subKeywords.join(\", \"),\n            titlewordcount: result.titleSEO.wordCount,\n            titlekeyworddensity: result.titleSEO.keywordWithTitle.density,\n            titlekeywordposition: result.titleSEO.keywordWithTitle.position,\n            titlekeyword: result.titleSEO.keywordWithTitle.keyword,\n            subkeywordswithtitle: result.titleSEO.subKeywordsWithTitle,\n            warning: result.messages.warnings,\n            goodpoints: result.messages.goodPoints,\n            minorwarnings: result.messages.minorWarnings,\n            totallinks: result.totalLinks,\n            internallinkscount: result.internalLinks.all.length,\n            uniqueinternallinkscount: result.internalLinks.unique.length,\n            duplicateinternallinkscount: result.internalLinks.duplicate.length,\n            uniqueinternallinks: result.internalLinks.unique,\n            duplicateinternallinks: result.internalLinks.duplicate,\n            externallinkscount: result.outboundLinks.all.length,\n            uniqueexternallinkscount: result.outboundLinks.unique.length,\n            duplicateexternallinkscount: result.outboundLinks.duplicate.length,\n            uniqueexternallinks: result.outboundLinks.unique,\n            duplicateexternallinks: result.outboundLinks.duplicate,\n        };\n        let html = await Templates.render(\"theme_seo/seo-info\", context);\n        $('.seo-info-details').html(html);\n    });\n};\n"],"names":["publicPage","redirected","async","toogelTimeout","on","clearTimeout","slideToggle","setTimeout","isVisible","is","this","html","keywords","document","querySelector","content","split","map","value","trim","contentJson","title","htmlText","keyword","shift","subKeywords","metaDescription","languageCode","M","cfg","language","checker","SeoCheck","window","location","hostname","result","analyzeSeo","context","seoscore","seoScore","wordcount","wordCount","keywordseoscore","keywordSeoScore","keyworddensity","keywordDensity","keywordfrequency","keywordFrequency","pagetitle","metadescription","subkeywords","join","titlewordcount","titleSEO","titlekeyworddensity","keywordWithTitle","density","titlekeywordposition","position","titlekeyword","subkeywordswithtitle","subKeywordsWithTitle","warning","messages","warnings","goodpoints","goodPoints","minorwarnings","minorWarnings","totallinks","totalLinks","internallinkscount","internalLinks","all","length","uniqueinternallinkscount","unique","duplicateinternallinkscount","duplicate","uniqueinternallinks","duplicateinternallinks","externallinkscount","outboundLinks","uniqueexternallinkscount","duplicateexternallinkscount","uniqueexternallinks","duplicateexternallinks","Templates","render"],"mappings":";;;;;;;;4NA8BoB,eAASA,sEAAmBC,wFAC1CC,sEACMC,qCACF,+BAA+BC,GAAG,SAAS,WACzCC,aAAaF,mCACX,gCAAgCG,cAElCH,cAAgBI,YAAW,SACnBC,WAAY,mBAAE,gCAAgCC,GAAG,gCACnDC,MAAMC,KAAKH,UAAY,UAAY,aACtC,SAEFR,YAAcC,sBAIfW,wCAAWC,SAASC,cAAc,uFAA0BC,UAAW,GAC3EH,SAAWA,SAASI,MAAM,KAAKC,KAAKC,OAAUA,MAAMC,eAE9CC,YAAc,CAChBC,MAAOR,SAASQ,OAAS,gBAEzBC,UAAU,mBAAE,qCAAqCX,OACjDY,QAASX,SAASY,SAAW,GAC7BC,YAAab,SACbc,gDAAiBb,SAASC,cAAc,4FAA6BC,UAAW,GAChFY,aAAcC,EAAEC,IAAIC,cAKpBC,QAAU,IAAIC,eAASZ,YAAaa,OAAOC,SAASC,UAAU,GAG9DC,aAAeL,QAAQM,aAKvBC,QAAU,CACVC,SAAUH,OAAOI,SACjBC,UAAWL,OAAOM,UAClBC,gBAAiBP,OAAOQ,gBACxBC,eAAgBT,OAAOU,eACvBC,iBAAkBX,OAAOY,iBACzBC,UAAW7B,YAAYC,MACvB6B,gBAAiB9B,YAAYM,gBAC7BH,QAASH,YAAYG,QACrB4B,YAAa/B,YAAYK,YAAY2B,KAAK,MAC1CC,eAAgBjB,OAAOkB,SAASZ,UAChCa,oBAAqBnB,OAAOkB,SAASE,iBAAiBC,QACtDC,qBAAsBtB,OAAOkB,SAASE,iBAAiBG,SACvDC,aAAcxB,OAAOkB,SAASE,iBAAiBjC,QAC/CsC,qBAAsBzB,OAAOkB,SAASQ,qBACtCC,QAAS3B,OAAO4B,SAASC,SACzBC,WAAY9B,OAAO4B,SAASG,WAC5BC,cAAehC,OAAO4B,SAASK,cAC/BC,WAAYlC,OAAOmC,WACnBC,mBAAoBpC,OAAOqC,cAAcC,IAAIC,OAC7CC,yBAA0BxC,OAAOqC,cAAcI,OAAOF,OACtDG,4BAA6B1C,OAAOqC,cAAcM,UAAUJ,OAC5DK,oBAAqB5C,OAAOqC,cAAcI,OAC1CI,uBAAwB7C,OAAOqC,cAAcM,UAC7CG,mBAAoB9C,OAAO+C,cAAcT,IAAIC,OAC7CS,yBAA0BhD,OAAO+C,cAAcN,OAAOF,OACtDU,4BAA6BjD,OAAO+C,cAAcJ,UAAUJ,OAC5DW,oBAAqBlD,OAAO+C,cAAcN,OAC1CU,uBAAwBnD,OAAO+C,cAAcJ,WAE7CpE,WAAa6E,mBAAUC,OAAO,qBAAsBnD,6BACtD,qBAAqB3B,KAAKA"}